/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2018
 * @version   3.2.9
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2018, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
var kvExpandRow;!function(e){"use strict";kvExpandRow=function(n,t){var a=".kvExpandRowColumn",l="kvRowNum_"+t,o=n.gridId,d=n.hiddenFromExport,i=n.detailUrl,s=n.onDetailLoaded,r=n.expandIcon,c=n.collapseIcon,v=n.expandTitle,p=n.collapseTitle,f=n.expandAllTitle,u=n.collapseAllTitle,x=n.expandOneOnly,k=n.enableRowClick,h=n.rowClickExcludedTags,g=n.enableCache,w=n.extraData,C=d?n.rowCssClass+" skip-export":n.rowCssClass,m=n.animationDuration,A=e("#"+o),y="."+t,b=A.find(".kv-expand-header-cell.kv-batch-toggle"+y),R=b.find(".kv-expand-header-icon"),E=void 0===n.collapseAll?!1:n.collapseAll,I=void 0===n.expandAll?!1:n.expandAll,T=A.find("td.kv-expand-icon-cell"+y+" .kv-expand-row:not(.kv-state-disabled)"),N=T.length,D="kv-expand-detail-loading",j=function(){var n=A.find("td.kv-expand-icon-cell"+y+":first"),t=n&&n.length?n.closest("tr"):"",a=0;return t&&t.length?(t.find("> td").each(function(){"none"!==e(this).css("display")&&a++}),a):0},L=j(),O=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},U=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},F=function(e,n){e.length&&e.removeClass(n).addClass(n)},K=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},Q=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},_=function(e){F(e,D)},q=function(e){if(e.length){var n=isNaN(m)?1e3:m+200;setTimeout(function(){e.removeClass(D)},n)}},z=function(){var e=A.data(l);return e=e?parseInt(e):0,isNaN(e)?0:e},B=function(e){A.data(l,e)},G=function(){var e=z();A.data(l,e+1)},H=function(e,n,t,l){var o=l?n:n.split(" ").join(a+" ")+a;e.length&&e.off(o).on(o,t)};return A.data(l)||B(0),0===w.length&&(w={}),0===T.length?void F(b,"kv-state-disabled"):(T.each(function(){var t,a,l=e(this),o=l.find(".kv-expand-icon"),d=o.closest(".kv-expand-icon-cell"),f=l.closest("tr"),u=d.find(".kv-expand-detail"),j=l.find(".kv-expanded-row"+y+":first"),F=j.data("key"),B=j.data("index");if(!O(o)&&!U(o))return!0;0===j.length&&(F=f.data("key"),t=f.next('tr.kv-expand-detail-row[data-key="'+F+'"]'),j=t.find(".kv-expanded-row"));var J=function(n){var t=e.extend({expandRowKey:F,expandRowInd:B},w),a=g?0===j.html().length:!0;return _(d),i.length>0&&a?(A.trigger("kvexprow:beforeLoad",[B,F,w]),void j.load(i,t,function(){q(d),"function"==typeof s&&s(),n(),A.trigger("kvexprow:loaded",[B,F,w])})):(q(d),void n())},M=function(n){A.find('tr[data-index="'+B+'"]').remove(),j.hide(),f.after(j);var t='<tr class="kv-expand-detail-row '+C+'" data-key="'+F+'" data-index="'+B+'">';j.wrap('<td colspan="'+L+'">').parent().wrap(t),o.html(c),d.attr("title",p),n?j.slideDown(m,function(){Q(o),j.show()}):(j.show(),Q(o));var a=f.prevAll(),l=f.index()+1;a.push(f),e.each(a,function(n,t){var a=e(t).find("td[rowspan]");e.each(a,function(n,a){var o=parseInt(e(a).attr("rowspan"));e(t).index()+o>l&&e(a).attr("rowspan",o+1)})}),0===i.length&&q(d)},P=function(){_(d),u.html(""),o.html(r),d.attr("title",v),a=j.closest(".kv-expand-detail-row"),j.slideUp(m,function(){j.unwrap().unwrap(),j.appendTo(u),K(o);var n=f.prevAll();n.push(f);var t=f.index()+1;e.each(n,function(n,a){var l=e(a).find("td[rowspan]");e.each(l,function(n,l){var o=parseInt(e(l).attr("rowspan"));e(a).index()+o>t&&e(l).attr("rowspan",o-1)})})}),q(d)},S=function(){var t,a,l=!1,i=!1;if(!d.hasClass(D)){if(U(o)){if(a=x&&!E){if(t=e.extend({},n,{collapseAll:!0}),T.each(function(){return e(this).closest(".kv-expand-icon-cell").hasClass(D)?void(i=!0):void 0}),i)return;kvExpandRow(t),l=!0}return J(function(){M(!0)}),void(a&&!l||(A.trigger("kvexprow:toggle",[B,F,w,!0]),o.focus()))}O(o)&&(P(),A.trigger("kvexprow:toggle",[B,F,w,!1]),o.focus())}};return I?(U(o)&&J(function(){M(!0),G(),z()>=N&&(q(b),R.focus())}),z()>=N&&(q(b),R.focus()),!0):E?(O(o)&&(P(),G(),z()>=N&&(q(b),R.focus())),z()>=N&&(q(b),R.focus()),!0):(O(o)&&(i?J(function(){M(!1)}):M(!1)),H(d,"click",function(){S(d)}),void H(f,"click",function(n){var t=n.target,a=e(t).length&&e(t).hasClass("kv-disable-click")||-1!==e.inArray(t.nodeName,h);k&&!a&&S(d)}))}),void(b.length&&H(b,"click",function(){if(!b.hasClass(D)&&0!==T.length){var a=U(R),l=O(R),o=e.extend({},n,{expandAll:l,collapseAll:a});_(b),l?(B(T.find(".kv-state-collapsed").length),K(R),R.html(c),b.attr("title",u),A.trigger("kvexprow:toggleAll",[w,!1])):a&&(B(T.find(".kv-state-expanded").length),Q(R),R.html(r),b.attr("title",f),A.trigger("kvexprow:toggleAll",[w,!0])),kvExpandRow(o,t)}})))}}(window.jQuery);
